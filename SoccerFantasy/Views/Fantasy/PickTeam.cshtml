@{
    string fteamId = CurrentUser.Instance.fantasyTeam.fantasyTeamId.ToString();
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="~/lib/flag-icons-main/css/flag-icons.min.css" />
    <title>@ViewBag.Title</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        .container {
            position: relative;
        }

        .gk {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }

        .defenders {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            display: flex;
            align-items: center;
        }

        .df {
            margin-left: 30px; /* Adjust the spacing between defenders */
        }

        .midfielders {
            position: absolute;
            top: 45%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            display: flex;
            align-items: center;
        }

        .mf {
            margin-left: 30px;
        }

        .attackers {
            position: absolute;
            top: 70%;
            left: 47%;
            transform: translateX(-50%);
            z-index: 2;
            display: flex;
        }

        .af {
            margin-left: 45px; /* Adjust the spacing between defenders */
        }
        /* You can adjust the styles as needed */
        .player img {
            width: 64px; /* Set the width of player images */
            height: 64px; /* Set the height of player images */
        }

        .soccer-field {
            position: relative;
            z-index: 1;
            height : 950px;
        }
    </style>
</head>
<body>
    <div class="text-center row">
        <div class="container col">
            <img class="soccer-field" src="https://upload.wikimedia.org/wikipedia/commons/8/82/Soccer_Field_Transparant.svg"/>
            <div class="gk" style="align-items: center;" onclick="toggleTable('GK')">
                <button style="align-items: center;" class="gk" onclick="toggleTable('GK','@fteamId')">
                    <img class="player" src="@(CurrentUser.Instance?.fantasyTeam?.players?.Where(p=> p.position.Contains("GK"))?.Select(p => p.playerImageURL).FirstOrDefault() ?? "https://cdn-icons-png.flaticon.com/64/2265/2265274.png")" alt="Goalkeeper" height="64" width="64" />
                    <p>DF</p>
                </button>
            </div>
            <div class="defenders">
                @for (int i = 0; i < 4; i++)
                    {
                        var player = @CurrentUser.Instance?.fantasyTeam?.players?
                        .Where(p => p.position.Contains("DF"))?
                        .Select(p => new
                        {
                            playerName = p.name,
                            playerImg = p.playerImageURL,
                            points = p.fantasy_round_points
                        }
                        )
                        .ToList()
                        .ElementAtOrDefault(i);
                    <button style="align-items: center;" class="df" onclick="toggleTable('DF','@fteamId')">
                        <img class="player" src="@(player?.playerImg ?? "https://cdn-icons-png.flaticon.com/64/2265/2265274.png")" alt="Goalkeeper" height="64" width="64" />
                        <p>@(player?.playerName ?? "")</p>
                        <p>DF</p>
                        <p>@(player?.points ?? null)</p>
                    </button>
                }
            </div>
            <div class="midfielders">
                @for (int i = 0; i < 4; i++)
                    {
                        var player = @CurrentUser.Instance?.fantasyTeam?.players?
                            .Where(p => p.position.Contains("MF"))?
                            .Select(p => new {
                                playerName = p.name,
                                playerImg = p.playerImageURL,
                                points = p.fantasy_round_points }
                            )
                            .ToList()
                            .ElementAtOrDefault(i);
                    <button style="align-items: center;" class="mf" onclick="toggleTable('MF','@fteamId')">
                        <img class="player" src="@(player?.playerImg ?? "https://cdn-icons-png.flaticon.com/64/2265/2265274.png")" alt="Goalkeeper" height="64" width="64" />
                        <p>@(player?.playerName ?? "")</p>
                        <p>MF</p>
                        <p>@(player?.points ?? null)</p>
                    </button>
                }
            </div>
            <div class="attackers">
                @for (int i = 0; i < 2; i++)
                    {
                        var player = @CurrentUser.Instance?.fantasyTeam?.players?
                        .Where(p => p.position.Contains("FW"))?
                        .Select(p => new
                        {
                            playerName = p.name,
                            playerImg = p.playerImageURL,
                            points = p.fantasy_round_points
                        }
                        )
                        .ToList()
                        .ElementAtOrDefault(i);
                    <button style="align-items: center;" class="af" onclick="toggleTable('FW','@fteamId')">
                        <img class="player" src="@(player?.playerImg ?? "https://cdn-icons-png.flaticon.com/64/2265/2265274.png")" alt="Goalkeeper" height="64" width="64" />
                        <p>@(player?.playerName ?? "")</p>
                        <p>FW</p>
                        <p>@(player?.points ?? null)</p>
                    </button>
                }
            </div>
        </div>
        <div id="tableContainer" class="col" style="display:none;">
            <div class="table-container" style="max-height: 690px; overflow-y: auto; max-width: 100%">
                <table id="playersTable" style="max-width: 100%">
                    <thead style="background-color: gray; width: 100%;">
                        <tr style="max-width: 100%">
                            <th style="text-align:left">Name</th>
                            <th style="text-align:center">Position</th>
                            <th style="text-align: center">Nationality</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function toggleTable(position, fteamId) {
        var tableContainer = document.getElementById("tableContainer");
        var playersTable = document.getElementById("playersTable");
        var tableBody = playersTable.getElementsByTagName('tbody')[0];
        tableBody.innerHTML = "";

        // Corrected syntax for $.getJSON
        $.getJSON(`https://localhost:7274/Players/getPlayersByPosition?position=${position}`, function (playersList) {
            for (var i = 0; i < playersList.length; i++) {
                var player = playersList[i];
                var row = tableBody.insertRow();

                var link = document.createElement('a');
                link.href = `#`;
                link.textContent = player.name;

                // Use a function to create a closure
                function createClickHandler(playerId) {
                    return function () {
                        //debugger;
                        $.ajax({
                            type: "POST",
                            url: `https://localhost:7274/Players/addPlayerToFantasyTeam?fantasyTeamId=${fteamId}&playerId=${playerId}`,
                            success: function (response) {
                                console.log(response);
                                location.reload();
                            },
                            error: function (error) {
                                console.log(error);
                            }
                        });
                    };
                }

                link.addEventListener('click', createClickHandler(player.playerId));

                var nameCell = row.insertCell(0);
                nameCell.appendChild(link);

                var positionCell = row.insertCell(1);
                positionCell.textContent = player.position;

                var nationalityCell = row.insertCell(2);
                nationalityCell.textContent = player.nationality;
            }

            // Toggle the display property
            if (tableContainer.style.display == "none") {
                tableContainer.style.display = "block";
            }
        });
    }</script>

